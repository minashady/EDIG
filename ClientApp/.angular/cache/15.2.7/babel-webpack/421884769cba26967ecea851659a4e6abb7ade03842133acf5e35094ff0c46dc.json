{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { catchError, throwError } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"../../../Services/webSocket.service\";\nimport * as i4 from \"@angular/common\";\nfunction StocksComponent_tr_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"date\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const order_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(order_r2.symbol);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(order_r2.type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", order_r2.quantity, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(9, 4, order_r2.timeStamp, \"medium\"));\n  }\n}\nfunction StocksComponent_tr_75_td_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const stock_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, stock_r3.priceHistories[stock_r3.priceHistories.length - 2].price, \"1.2-2\"));\n  }\n}\nfunction StocksComponent_tr_75_td_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const stock_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, stock_r3.priceHistories[stock_r3.priceHistories.length - 2].timeStamp, \"medium\"));\n  }\n}\nconst _c0 = function (a0, a1) {\n  return {\n    \"price-up\": a0,\n    \"price-down\": a1\n  };\n};\nfunction StocksComponent_tr_75_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 27);\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, StocksComponent_tr_75_td_8_Template, 3, 4, \"td\", 28);\n    i0.ɵɵtemplate(9, StocksComponent_tr_75_td_9_Template, 3, 4, \"td\", 28);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const stock_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(stock_r3.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(stock_r3.symbol);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(9, _c0, stock_r3.priceHistories && stock_r3.priceHistories.length > 1 && stock_r3.currentPrice > stock_r3.priceHistories[stock_r3.priceHistories.length - 2].price, stock_r3.priceHistories && stock_r3.priceHistories.length > 1 && stock_r3.currentPrice < stock_r3.priceHistories[stock_r3.priceHistories.length - 2].price));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(7, 6, stock_r3.currentPrice, \"1.2-2\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", stock_r3.priceHistories && stock_r3.priceHistories.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", stock_r3.priceHistories && stock_r3.priceHistories.length > 0);\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    \"show\": a0\n  };\n};\nconst _c2 = function (a0) {\n  return {\n    \"display\": a0\n  };\n};\nexport class StocksComponent {\n  constructor(fb, http, webSocketService) {\n    this.fb = fb;\n    this.http = http;\n    this.webSocketService = webSocketService;\n    this.isModalOpen = false;\n    this.isModalHistoryOpen = false;\n    this.stocks = [];\n    this.orders = [];\n    this.form = this.fb.group({\n      stockSymbol: [''],\n      orderType: [''],\n      quantity: ['']\n    });\n  }\n  openModal() {\n    this.isModalOpen = true;\n  }\n  closeModal() {\n    this.isModalOpen = false;\n  }\n  openHistoryModal() {\n    const headers = new HttpHeaders().set('X-Api-Key', 'EDIG_Assessment');\n    this.http.get('http://localhost:7272/order', {\n      headers\n    }).subscribe(data => {\n      this.orders = data;\n    });\n    this.isModalHistoryOpen = true;\n  }\n  closeHistoryModal() {\n    this.isModalHistoryOpen = false;\n  }\n  ngOnInit() {\n    this.getStocks();\n  }\n  getStocks() {\n    const headers = new HttpHeaders().set('X-Api-Key', 'EDIG_Assessment');\n    this.http.get('http://localhost:7272/stocks', {\n      headers\n    }).subscribe(data => {\n      this.stocks = data;\n    });\n    this.webSocketService.getMessages().pipe(catchError(err => {\n      console.error('Error in subscribe:', err);\n      return throwError(err);\n    })).subscribe(PriceUpdate => {\n      console.log(\"frontend updating\");\n      // Find the stock that was updated\n      const stock = this.stocks.find(s => s.symbol === PriceUpdate.symbol);\n      if (stock) {\n        // Get the previous price from PriceHistories\n        const previousPrice = stock.priceHistories[stock.priceHistories.length - 1].price;\n        // Update the current price\n        stock.currentPrice = PriceUpdate.price;\n        // Add the new price to PriceHistories\n        stock.priceHistories.push({\n          price: PriceUpdate.price,\n          timeStamp: new Date().toISOString()\n        });\n        stock.isPriceRecentlyUpdated = true;\n        setTimeout(() => {\n          stock.isPriceRecentlyUpdated = false;\n        }, 3000);\n      }\n    });\n  }\n  placeOrder() {\n    const headers = new HttpHeaders().set('X-Api-Key', 'EDIG_Assessment');\n    const order = {\n      Symbol: this.form.get('stockSymbol')?.value,\n      Type: this.form.get('orderType')?.value,\n      Quantity: this.form.get('quantity')?.value,\n      TimeStamp: new Date().toISOString()\n    };\n    this.http.post('http://localhost:7272/order', order, {\n      headers\n    }).subscribe(response => {\n      console.log(response);\n    });\n    this.closeModal();\n  }\n}\nStocksComponent.ɵfac = function StocksComponent_Factory(t) {\n  return new (t || StocksComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.HttpClient), i0.ɵɵdirectiveInject(i3.WebSocketService));\n};\nStocksComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: StocksComponent,\n  selectors: [[\"app-stocks\"]],\n  decls: 76,\n  vars: 15,\n  consts: [[1, \"text-md-center\", \"m-5\"], [2, \"background-color\", \"snow\", \"border-radius\", \"10px\", \"box-shadow\", \"5px 5px 15px rgba(0,0,0,0.3)\", \"padding\", \"20px\"], [2, \"display\", \"flex\", \"justify-content\", \"space-between\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline\", 3, \"click\"], [\"tabindex\", \"-1\", \"role\", \"dialog\", \"aria-labelledby\", \"orderModalLabel\", \"aria-hidden\", \"true\", 1, \"modal\", 3, \"ngClass\", \"ngStyle\"], [\"role\", \"document\", 1, \"modal-dialog\"], [1, \"modal-content\", 2, \"background-color\", \"snow\", \"border-radius\", \"10px\", \"box-shadow\", \"5px 5px 15px rgba(0,0,0,0.3)\"], [1, \"modal-header\"], [\"id\", \"orderModalLabel\", 1, \"modal-title\"], [1, \"modal-body\"], [3, \"formGroup\"], [1, \"form-group\"], [\"for\", \"stockSymbol\"], [\"type\", \"text\", \"id\", \"stockSymbol\", \"formControlName\", \"stockSymbol\", \"placeholder\", \"Enter Stock Symbol\", 1, \"form-control\"], [\"for\", \"orderType\"], [\"formControlName\", \"orderType\", \"id\", \"orderType\", 1, \"form-control\"], [\"for\", \"quantity\"], [\"type\", \"number\", \"id\", \"quantity\", \"formControlName\", \"quantity\", \"placeholder\", \"Enter Quantity\", 1, \"form-control\"], [1, \"modal-footer\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", 1, \"btn\", \"btn-secondary\", 3, \"click\"], [\"id\", \"orderHistoryModalLabel\", 1, \"modal-title\"], [1, \"modal-body\", \"table-responsive\"], [1, \"table\", \"table-striped\"], [\"scope\", \"col\"], [4, \"ngFor\", \"ngForOf\"], [1, \"table-responsive\"], [3, \"ngClass\"], [4, \"ngIf\"]],\n  template: function StocksComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"h3\", 0);\n      i0.ɵɵtext(1, \"Sample Stocks\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"div\", 1)(3, \"div\", 2)(4, \"button\", 3);\n      i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_4_listener() {\n        return ctx.openModal();\n      });\n      i0.ɵɵtext(5, \" Place Order \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"button\", 4);\n      i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_6_listener() {\n        return ctx.openHistoryModal();\n      });\n      i0.ɵɵtext(7, \" Order history \");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(8, \"div\", 5)(9, \"div\", 6)(10, \"div\", 7)(11, \"div\", 8)(12, \"h5\", 9);\n      i0.ɵɵtext(13, \"Place Order\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(14, \"div\", 10)(15, \"form\", 11)(16, \"div\", 12)(17, \"label\", 13);\n      i0.ɵɵtext(18, \"Stock Symbol\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(19, \"input\", 14);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(20, \"div\", 12)(21, \"label\", 15);\n      i0.ɵɵtext(22, \"Order Type\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"select\", 16)(24, \"option\");\n      i0.ɵɵtext(25, \"Buy\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(26, \"option\");\n      i0.ɵɵtext(27, \"Sell\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(28, \"div\", 12)(29, \"label\", 17);\n      i0.ɵɵtext(30, \"Quantity\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(31, \"input\", 18);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(32, \"div\", 19)(33, \"button\", 20);\n      i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_33_listener() {\n        return ctx.closeModal();\n      });\n      i0.ɵɵtext(34, \"Close\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(35, \"button\", 3);\n      i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_35_listener() {\n        return ctx.placeOrder();\n      });\n      i0.ɵɵtext(36, \"Place Order\");\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵelementStart(37, \"div\", 5)(38, \"div\", 6)(39, \"div\", 7)(40, \"div\", 8)(41, \"h5\", 21);\n      i0.ɵɵtext(42, \"Place Order\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(43, \"div\", 22)(44, \"table\", 23)(45, \"thead\")(46, \"tr\")(47, \"th\", 24);\n      i0.ɵɵtext(48, \"Stock Symbol\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(49, \"th\", 24);\n      i0.ɵɵtext(50, \"Order Type\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(51, \"th\", 24);\n      i0.ɵɵtext(52, \"Quantity\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(53, \"th\", 24);\n      i0.ɵɵtext(54, \"Time Stamp\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(55, \"tbody\");\n      i0.ɵɵtemplate(56, StocksComponent_tr_56_Template, 10, 7, \"tr\", 25);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(57, \"div\", 19)(58, \"button\", 20);\n      i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_58_listener() {\n        return ctx.closeHistoryModal();\n      });\n      i0.ɵɵtext(59, \"Close\");\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵelementStart(60, \"div\", 26)(61, \"table\", 23)(62, \"thead\")(63, \"tr\")(64, \"th\", 24);\n      i0.ɵɵtext(65, \"Title\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(66, \"th\", 24);\n      i0.ɵɵtext(67, \"Symbol\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(68, \"th\", 24);\n      i0.ɵɵtext(69, \"Current Price\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(70, \"th\", 24);\n      i0.ɵɵtext(71, \"Past Price\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(72, \"th\", 24);\n      i0.ɵɵtext(73, \"Time Stamp\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(74, \"tbody\");\n      i0.ɵɵtemplate(75, StocksComponent_tr_75_Template, 10, 12, \"tr\", 25);\n      i0.ɵɵelementEnd()()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(8);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(7, _c1, ctx.isModalOpen))(\"ngStyle\", i0.ɵɵpureFunction1(9, _c2, ctx.isModalOpen ? \"block\" : \"none\"));\n      i0.ɵɵadvance(7);\n      i0.ɵɵproperty(\"formGroup\", ctx.form);\n      i0.ɵɵadvance(22);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(11, _c1, ctx.isModalHistoryOpen))(\"ngStyle\", i0.ɵɵpureFunction1(13, _c2, ctx.isModalHistoryOpen ? \"block\" : \"none\"));\n      i0.ɵɵadvance(19);\n      i0.ɵɵproperty(\"ngForOf\", ctx.orders);\n      i0.ɵɵadvance(19);\n      i0.ɵɵproperty(\"ngForOf\", ctx.stocks);\n    }\n  },\n  dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i4.NgStyle, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i4.DecimalPipe, i4.DatePipe],\n  styles: [\".price-up[_ngcontent-%COMP%] {\\r\\n  color: green; \\r\\n}\\r\\n\\r\\n.price-down[_ngcontent-%COMP%] {\\r\\n  color: red;\\r\\n}\\r\\n\\r\\n.price-normal[_ngcontent-%COMP%] {\\r\\n  color: black;\\r\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvc3RvY2tzL3N0b2Nrcy5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsWUFBWTtBQUNkOztBQUVBO0VBQ0UsVUFBVTtBQUNaOztBQUVBO0VBQ0UsWUFBWTtBQUNkIiwic291cmNlc0NvbnRlbnQiOlsiLnByaWNlLXVwIHtcclxuICBjb2xvcjogZ3JlZW47IFxyXG59XHJcblxyXG4ucHJpY2UtZG93biB7XHJcbiAgY29sb3I6IHJlZDtcclxufVxyXG5cclxuLnByaWNlLW5vcm1hbCB7XHJcbiAgY29sb3I6IGJsYWNrO1xyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["HttpHeaders","catchError","throwError","i0","StocksComponent","constructor","fb","http","webSocketService","stocks","orders","form","group","stockSymbol","orderType","quantity","openModal","isModalOpen","closeModal","openHistoryModal","headers","set","get","subscribe","data","isModalHistoryOpen","closeHistoryModal","ngOnInit","getStocks","getMessages","pipe","err","console","error","PriceUpdate","log","stock","find","s","symbol","previousPrice","priceHistories","length","price","currentPrice","push","timeStamp","Date","toISOString","isPriceRecentlyUpdated","setTimeout","placeOrder","order","Symbol","value","Type","Quantity","TimeStamp","post","response","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["W:\\97_Applying\\EDIG\\Stock_Exchange\\Stock_Exchange\\ClientApp\\src\\app\\stocks\\stocks.component.ts","W:\\97_Applying\\EDIG\\Stock_Exchange\\Stock_Exchange\\ClientApp\\src\\app\\stocks\\stocks.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { HttpHeaders } from '@angular/common/http';\r\nimport { WebSocketService } from '../../../Services/webSocket.service';\r\nimport { catchError, throwError } from 'rxjs';\r\nimport { ReactiveFormsModule,FormBuilder, FormGroup } from '@angular/forms';\r\n\r\n\r\n\r\n@Component({\r\n  selector: 'app-stocks',\r\n  templateUrl: './stocks.component.html',\r\n  styleUrls: ['./stocks.component.css']\r\n})\r\nexport class StocksComponent implements OnInit {\r\n  stocks: StocksDetails[];\r\n  orders: OrdersDetails[];\r\n  form: FormGroup;\r\n  isModalOpen = false;\r\n  isModalHistoryOpen = false;\r\n \r\n\r\n  constructor(private fb: FormBuilder, private http: HttpClient, private webSocketService: WebSocketService) { // Inject WebSocketService\r\n    this.stocks = [];\r\n    this.orders = [];\r\n    this.form = this.fb.group({\r\n      stockSymbol: [''],\r\n      orderType: [''],\r\n      quantity: ['']\r\n    });\r\n  }\r\n  openModal() {\r\n    this.isModalOpen = true;\r\n  }\r\n\r\n  closeModal() {\r\n    this.isModalOpen = false;\r\n  }\r\n  openHistoryModal() {\r\n    const headers = new HttpHeaders().set('X-Api-Key', 'EDIG_Assessment');\r\n    this.http.get<OrdersDetails[]>('http://localhost:7272/order', { headers }).subscribe(data => {\r\n      this.orders = data;\r\n    });\r\n\r\n    this.isModalHistoryOpen = true;\r\n  }\r\n\r\n  closeHistoryModal() {\r\n    this.isModalHistoryOpen = false;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.getStocks();\r\n  }\r\n\r\n  getStocks() {\r\n    const headers = new HttpHeaders().set('X-Api-Key', 'EDIG_Assessment');\r\n\r\n    this.http.get<StocksDetails[]>('http://localhost:7272/stocks', { headers }).subscribe(data => {\r\n      this.stocks = data;\r\n    });\r\n\r\n    this.webSocketService.getMessages().pipe(\r\n      catchError(err => {\r\n        console.error('Error in subscribe:', err);\r\n        return throwError(err);\r\n      })\r\n    ).subscribe((PriceUpdate: StockUpdate) => { // Specify the type of update\r\n      console.log(\"frontend updating\");\r\n      // Find the stock that was updated\r\n      const stock = this.stocks.find(s => s.symbol === PriceUpdate.symbol);\r\n\r\n      if (stock) {\r\n        // Get the previous price from PriceHistories\r\n        const previousPrice = stock.priceHistories[stock.priceHistories.length - 1].price;\r\n\r\n        // Update the current price\r\n        stock.currentPrice = PriceUpdate.price;\r\n\r\n        // Add the new price to PriceHistories\r\n        stock.priceHistories.push({ price: PriceUpdate.price, timeStamp: new Date().toISOString() });\r\n\r\n        stock.isPriceRecentlyUpdated = true;\r\n        setTimeout(() => {\r\n          stock.isPriceRecentlyUpdated = false;\r\n        }, 3000);\r\n      }\r\n    });\r\n  }\r\n  placeOrder() {\r\n    const headers = new HttpHeaders().set('X-Api-Key', 'EDIG_Assessment');\r\n    const order = {\r\n      Symbol: this.form.get('stockSymbol')?.value,\r\n      Type: this.form.get('orderType')?.value,\r\n      Quantity: this.form.get('quantity')?.value,\r\n      TimeStamp: new Date().toISOString()\r\n    };\r\n\r\n    this.http.post('http://localhost:7272/order', order, { headers }).subscribe(response => {\r\n      console.log(response);\r\n    });\r\n    this.closeModal();\r\n  }\r\n\r\n}\r\n\r\nexport interface StocksDetails {\r\n  title: string,\r\n  symbol: string,\r\n  currentPrice: number,\r\n  priceHistories: PriceHistory[]\r\n  isPriceRecentlyUpdated?: boolean;\r\n}\r\nexport interface OrdersDetails {\r\n  symbol: string,\r\n  type: string,\r\n  quantity: number,\r\n  timeStamp: string\r\n}\r\n\r\n\r\nexport interface PriceHistory {\r\n  price: number,\r\n  timeStamp: string\r\n}\r\nexport interface StockUpdate {\r\n  symbol: string;\r\n  price: number;\r\n}\r\n","<h3 class=\"text-md-center m-5\">Sample Stocks</h3>\r\n<div style=\"background-color:snow; border-radius: 10px; box-shadow: 5px 5px 15px rgba(0,0,0,0.3); padding: 20px;\">\r\n  <div style=\"display: flex; justify-content: space-between;\">\r\n    <!-- Place Order Button -->\r\n    <button type=\"button\" class=\"btn btn-primary\" (click)=\"openModal()\">\r\n      Place Order\r\n    </button>\r\n    <!-- Order History Button -->\r\n    <button type=\"button\" class=\"btn btn-outline\" (click)=\"openHistoryModal()\">\r\n      Order history\r\n    </button>\r\n  </div>\r\n  <!-- Order Modal -->\r\n  <div class=\"modal\"  [ngClass]=\"{'show': isModalOpen}\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"orderModalLabel\" aria-hidden=\"true\" [ngStyle]=\"{'display': isModalOpen ? 'block' : 'none'}\">\r\n    <div class=\"modal-dialog\" role=\"document\">\r\n      <div class=\"modal-content\" style=\"background-color:snow; border-radius: 10px; box-shadow: 5px 5px 15px rgba(0,0,0,0.3);\">\r\n        <div class=\"modal-header\">\r\n          <h5 class=\"modal-title\" id=\"orderModalLabel\">Place Order</h5>\r\n          <!--<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n            <span aria-hidden=\"true\">&times;</span>\r\n          </button>-->\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <form [formGroup]=\"form\">\r\n            <div class=\"form-group\">\r\n              <label for=\"stockSymbol\">Stock Symbol</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"stockSymbol\" formControlName=\"stockSymbol\" placeholder=\"Enter Stock Symbol\">\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"orderType\">Order Type</label>\r\n              <select class=\"form-control\" formControlName=\"orderType\" id=\"orderType\">\r\n                <option>Buy</option>\r\n                <option>Sell</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"quantity\">Quantity</label>\r\n              <input type=\"number\" class=\"form-control\" id=\"quantity\" formControlName=\"quantity\" placeholder=\"Enter Quantity\">\r\n            </div>\r\n          </form>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\" (click)=\"closeModal()\">Close</button>\r\n          <button type=\"button\" class=\"btn btn-primary\" (click)=\"placeOrder()\">Place Order</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Order History Modal -->\r\n  <div class=\"modal\"  [ngClass]=\"{'show': isModalHistoryOpen}\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"orderModalLabel\" aria-hidden=\"true\" [ngStyle]=\"{'display': isModalHistoryOpen ? 'block' : 'none'}\">\r\n    <div class=\"modal-dialog\" role=\"document\">\r\n      <div class=\"modal-content\" style=\"background-color:snow; border-radius: 10px; box-shadow: 5px 5px 15px rgba(0,0,0,0.3);\">\r\n        <div class=\"modal-header\">\r\n          <h5 class=\"modal-title\" id=\"orderHistoryModalLabel\">Place Order</h5>\r\n          <!--<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n            <span aria-hidden=\"true\">&times;</span>\r\n          </button>-->\r\n        </div>\r\n        <div class=\"modal-body table-responsive\">\r\n          <table class=\"table table-striped \">\r\n            <thead>\r\n              <tr>\r\n                <th scope=\"col\">Stock Symbol</th>\r\n                <th scope=\"col\">Order Type</th>\r\n                <th scope=\"col\">Quantity</th>\r\n                <th scope=\"col\">Time Stamp</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr *ngFor=\"let order of orders\">\r\n                <td>{{order.symbol}}</td>\r\n                <td>{{order.type}}</td>\r\n                <td>\r\n                  {{order.quantity}}\r\n                </td>\r\n                \r\n                <td>{{order.timeStamp | date:'medium'}}</td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\" (click)=\"closeHistoryModal()\">Close</button>\r\n          \r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\" table-responsive\">\r\n  <table class=\"table table-striped\">\r\n    <thead>\r\n      <tr>\r\n        <th scope=\"col\">Title</th>\r\n        <th scope=\"col\">Symbol</th>\r\n        <th scope=\"col\">Current Price</th>\r\n        <th scope=\"col\">Past Price</th>\r\n        <th scope=\"col\">Time Stamp</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr *ngFor=\"let stock of stocks\">\r\n        <td>{{stock.title}}</td>\r\n        <td>{{stock.symbol}}</td>\r\n        <td [ngClass]=\"{'price-up': stock.priceHistories && stock.priceHistories.length > 1 && stock.currentPrice > stock.priceHistories[stock.priceHistories.length - 2].price, 'price-down': stock.priceHistories && stock.priceHistories.length > 1 && stock.currentPrice < stock.priceHistories[stock.priceHistories.length - 2].price}\">\r\n          {{stock.currentPrice | number:'1.2-2'}}\r\n        </td>\r\n\r\n        <td *ngIf=\"stock.priceHistories && stock.priceHistories.length > 0\">{{stock.priceHistories[stock.priceHistories.length - 2].price | number:'1.2-2'}}</td>\r\n        <td *ngIf=\"stock.priceHistories && stock.priceHistories.length > 0\">{{stock.priceHistories[stock.priceHistories.length - 2].timeStamp | date:'medium'}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n    </div>\r\n</div>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}